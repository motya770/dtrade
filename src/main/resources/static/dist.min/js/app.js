var diamondApp=angular.module("diamondApp",["ngMaterial","ngMessages","ngCookies","ngRoute"]).filter("diamondTypeFilter",function(){return function(e){e=e||"";for(var t="",n=0;n<3;n++){t+=0==n?e.charAt(n).toUpperCase():e.charAt(n).toLowerCase()}return t}}).controller("TopController",["$scope","$timeout","$mdDialog",function(n,e,o,t,r){function a(e,t,n){t.diamond=e.getCurrentDiamond(),t.diamondImage="/image/diamond-image?image="+t.diamond.images[0].id;var o=0,r=t.diamond.images.length;t.primitiveRotator=function(e){o=++o==r?0:o,t.diamondImage="/image/diamond-image?image="+t.diamond.images[o].id},t.hide=function(){n.hide()},t.cancel=function(){n.cancel()},t.answer=function(e){n.hide(e)}}a.$inject=["DiamondService","$scope","$mdDialog"],n.loaded=!1,n.$on("accountReceived",function(e,t){n.loaded||(n.loaded=!0)}),n.showAdvanced=function(e,t){this.currentDiamond=e,o.show({controller:a,templateUrl:"dialog1.tmpl.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0})}}]);function arrayObjectIndexOf(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t.id)return n;return-1}angular.module("diamondApp").config(["$locationProvider","$routeProvider",function(e,t){e.hashPrefix("!"),t.when("/trade",{template:"<advanced-component></advanced-component>"}).when("/basic",{template:"<basic-component></basic-component>"}).when("/coins",{template:"<coins-component></coins-component>"}).when("/login-form",{template:"<login-form-component></login-form-component>"}).when("/account",{template:"<account-component></account-component>"}).otherwise("/trade")}]),angular.module("diamondApp").component("advancedComponent",{templateUrl:"/content/js/templates/advanced.html"}).component("basicComponent",{templateUrl:"/content/js/templates/basic.html"}).component("coinsComponent",{templateUrl:"/content/js/templates/coins.html"}).component("loginFormComponent",{templateUrl:"/content/js/templates/login-form.html"}).component("accountComponent",{templateUrl:"/content/js/templates/account.html"}),diamondApp.factory("AccountService",["$http",function(e){var t=this;t.currentAccount;var n=function(){return e.post("/accounts/get-current").then(function(e){return null!=t.currentAccount?t.currentAccount.balance=e.data.balance:t.currentAccount=e.data,t.currentAccount})};return{currentAccountCall:function(){return t.currentAccount,n()},refreshCurrentAccount:n}}]),diamondApp.controller("ConfigController",["$scope","$rootScope","$http","$cookies",function(e,t,n,o){var r=this,a=new URL(window.location.href),i=new URLSearchParams(a.search).get("config");null!=i&&""!=i&&o.put("config",i),n.get("/config/get").then(function(e){r.config=e.data})}]),diamondApp.controller("BalanceController",["AvailableService","$rootScope","$scope","$http",function(n,o,e,t){var r=this;t.post("/balance/get-balances",null).then(function(e){r.balances=e.data}),e.chooseBalance=function(e){var t=n.getDiamondByBaseCurrency(e);o.$broadcast("buyDiamondChoosed",t)}}]),diamondApp.service("DiamondService",["$http","$rootScope","$q",function(e,t,n){var o=null;return t.$on("buyDiamondChoosed",function(e,t){o=t}),t.$on("ownedDiamondChoosed",function(e,t){o=t}),t.$on("openForSaleDiamondChoosed",function(e,t){o=t}),{getCurrentDiamond:function(){return o},getAllEnlistedDiamonds:function(){return e.post("/diamond/available",null,null).then(function(e){return e.data})}}}]),diamondApp.controller("AccountController",["$scope","$rootScope","$http","AccountService",function(e,t,n,o){var r=this;o.currentAccountCall().then(function(e){"empty"==e.account?r.account=null:r.account=e,t.$broadcast("accountReceived",e)})}]),diamondApp.controller("AvailableController",["$scope","$http","$rootScope","$interval","$timeout","AvailableService",function(e,t,r,n,o,a){var d=this;e.chooseAvailableDiamond=function(e){r.$broadcast("buyDiamondChoosed",e)},e.searchInputValue="",e.getAvailableByName=function(){i(e.searchInputValue)};var i=function(e){a.getAvailable(e).then(function(e){var t=[];for(var n in e)if(t[n]=e[n],3<n)break;for(var n in d.availableDiamonds=t,d.availableDiamondsIds=new Array,d.availableDiamonds)d.availableDiamondsIds.push(d.availableDiamonds[n].id);if(null!=e&&0<e.length){var o=e[0];r.$broadcast("buyDiamondChoosed",o)}})};i(""),window.setInterval(function(){return t.post("/book-order/get-diamonds-spread",d.availableDiamondsIds).then(function(e){var t=e.data;for(var n in t){var o=t[n];if(null!=o){var r=o.first,a=o.second,i=(a.first+a.second)/2;for(var c in a.avg=i,d.availableDiamonds){var l=d.availableDiamonds[c];l.id==r.id&&(l.askBidPair=a)}}}})},1e3)}]),diamondApp.service("AvailableService",["$http","$q",function(t,e){var o=[];return{getAvailable:function(e){return t.post("/diamond/available?name="+e,null).then(function(e){return o=e.data})},getDiamondByBaseCurrency:function(e){for(var t in o){var n=o[t];if(n.currency==e)return n}}}}]),diamondApp.controller("HistoryTradeOrderController",["$scope","$q","$rootScope","$http","$interval","$timeout","DiamondService","AccountService","TradeOrderService",function(e,t,n,o,r,a,i,c,l){console.log("start: "+new Date),e.tab=3;var d=this,u=function(){null!=i.getCurrentDiamond()?l.getHistoryOrders(i.getCurrentDiamond()).then(function(e){d.historyTradeOrders=e}):a(u,50,!1)},s=r(u,1e3);e.$on("$destroy",function(){angular.isDefined(s)&&(r.cancel(s),s=void 0)})}]),diamondApp.controller("BidderController",["$scope","$rootScope","$http","AccountService","TradeOrderService","AlertService",function(o,e,r,a,i,c){var l=this;l.buyOrder={},l.sellOrder={},o.tab=5,a.currentAccountCall().then(function(e){l.currentAccount=e}),o.tradeOrder={diamond:"",initialAmount:"",price:null,account:null,tradeOrderDirection:"BUY"},o.createTradeOrder=function(e,t,n){null!=l.currentAccount&&"empty"!=l.currentAccount.account?(e.account=l.currentAccount,e.diamond=t,e.tradeOrderDirection=o.tradeOrder.tradeOrderDirection,e.tradeOrderType=n,r.post("/trade-order/create",e,null).then(function(e){e.data.error?c.showAlert(e.data.message):null!=e.data.id?(i.addLiveOrder(e.data),"BUY"==e.data.tradeOrderDirection&&a.refreshCurrentAccount()):c.showAlert("You should make login first.","Notification")},function(e){e.data.error&&c.showAlert(e.data.message)})):c.showAlert("You should make login first!","Notification")},o.sellOption=function(e){o.tradeOrder.tradeOrderDirection="SELL"},o.buyOption=function(e){o.tradeOrder.tradeOrderDirection="BUY"},o.$on("buyDiamondChoosed",function(e,t){l.diamond=t}),o.$on("buyDiamondChoosed",function(e,t){l.diamond=t})}]),diamondApp.controller("BookOrderController",["$scope","$http","$rootScope","$timeout","$interval","DiamondService","BookOrderService",function(e,t,n,o,r,a,i){var c=this;c.firstTimeOut=!0,c.spread=0;var l=function(){null!=a.getCurrentDiamond()?i.getBookOrder(a.getCurrentDiamond()).then(function(e){c.bookOrder=e,null!=c.bookOrder&&(null==c.bookOrder.buyOrders||null==c.bookOrder.sellOrders?c.spread=0:0<c.bookOrder.buyOrders.length&&0<c.bookOrder.sellOrders.length?c.spread=c.bookOrder.sellOrders[c.bookOrder.sellOrders.length-1].price-c.bookOrder.buyOrders[0].price:c.spread=0,c.firstTimeOut&&(c.firstTimeOut=!1,window.setInterval(l,1e3)))}):o(l,150,!1)};l()}]),diamondApp.service("BookOrderService",["$http",function(t){this.buyPrice=null,this.sellPrice=null;return{getBookOrder:function(e){return t.post("/book-order/",e.id,null).then(function(e){return e.data})},setSpread:function(e,t){}}}]),diamondApp.controller("ChartController",["$scope","$timeout","$http","$interval","$timeout","$q","DiamondService","AvailableService",function(e,t,n,o,t,r,a,i){var c=this;c.isFirstTimeout=!0,c.graph=null,c.lastTimeQuote=null,c.lastDiamondId=null,c.poolingPromise=null;e.tab=11;Highcharts.setOptions({time:{useUTC:!1},colors:["#d35400","#2980b9","#2ecc71","#f1c40f","#2c3e50","#7f8c8d"],chart:{style:{fontFamily:"Roboto",color:"#666666"}},title:{align:"left",style:{fontFamily:"Roboto Condensed",fontWeight:"bold"}},subtitle:{align:"left",style:{fontFamily:"Roboto Condensed"}},legend:{align:"right",verticalAlign:"bottom"},xAxis:{gridLineWidth:1,gridLineColor:"#F3F3F3",lineColor:"#F3F3F3",minorGridLineColor:"#F3F3F3",tickColor:"#F3F3F3",tickWidth:1},yAxis:{gridLineColor:"#F3F3F3",lineColor:"#F3F3F3",minorGridLineColor:"#F3F3F3",tickColor:"#F3F3F3",tickWidth:1},plotOptions:{line:{marker:{enabled:!1}},spline:{marker:{enabled:!1}},area:{marker:{enabled:!1}},areaspline:{marker:{enabled:!1}},bubble:{maxSize:"10%"}}});var l=function(e){var t=e;return 0<e.length&&(c.lastTimeQuote=e[e.length-1][0]),t},d=function(){null!=a.getCurrentDiamond()?n.post("/graph/get-quotes?diamond="+a.getCurrentDiamond().id,null).then(function(e){var t=l(e.data);c.graph=Highcharts.stockChart("container",{chart:{events:{load:function(){console.log("load1");var e=this;c.poolingPromise=o(function(){!function(e){if(null!=e.series){var o=e.series[0],t=null;t=null==c.lastTimeQuote?"/graph/get-quotes?diamond="+a.getCurrentDiamond().id:"/graph/get-quotes?diamond="+a.getCurrentDiamond().id+"&start="+c.lastTimeQuote,n.post(t,null).then(function(e){var t=l(e.data);for(var n in t)o.addPoint(t[n],!0,!0),n==t.length-1&&(c.lastTimeQuote=t[n][0])})}}(e)},1e3,0,!1)}}},rangeSelector:{buttons:[{count:1,type:"minute",text:"1M"},{count:5,type:"minute",text:"5M"},{type:"all",text:"All"}],inputEnabled:!1,selected:4},title:{text:""},exporting:{enabled:!1},series:[{name:"",data:t}]})}):t(d,500,!1)},u=function(){c.poolingPromise&&(o.cancel(c.poolingPromise),d(),s())};e.$on("buyDiamondChoosed",function(e,t){u()}),e.$on("ownedDiamondChoosed",function(e,t){u()}),e.$on("openForSaleDiamondChoosed",function(e,t){u()});var s=function(){null!=a.getCurrentDiamond()?n.get("/graph/get-depth-quotes?diamond="+a.getCurrentDiamond().id).then(function(e){var t=e.data,n=t.first,o=t.second,r=new Array,a=new Array;if(null!=n)for(var i=0;i<n.length;i++){var c=n[i];(l=new Array).push(c.price),l.push(c.amount),r.push(l)}if(null!=o)for(i=0;i<o.length;i++){var l;c=o[i];(l=new Array).push(c.price),l.push(c.amount),a.push(l)}Highcharts.chart("containerDepth",{chart:{type:"area",zoomType:"xy"},title:{text:"",style:{color:"#000000"}},subtitle:{text:"",style:{color:"#000000"}},xAxis:[{type:"logarithmic",title:{text:"Price",style:{color:"#000000"}},width:"50%",labels:{style:{color:"green"}}},{type:"logarithmic",title:{text:"Price",style:{color:"#000000"}},labels:{style:{color:"red"}},offset:0,left:"50%",width:"50%"}],yAxis:{gridLineWidth:0,title:{text:"Depth",style:{color:"#000000"}}},legend:{enabled:!1},plotOptions:{area:{softThreshold:!0,marker:{radius:2},lineWidth:2,states:{hover:{lineWidth:3}},threshold:null}},tooltip:{shared:!0,useHTML:!0,headerFormat:"<table>",pointFormat:'<tr><td>Price:</td><td style="text-align: right;">{point.x}</td></tr><tr><td>Sum ($):</td><td style="text-align: right;">{point.y}</td></tr>',footerFormat:"</table>",valueDecimals:2},series:[{name:"Bids",data:r,color:"#48d26f",fillColor:"#48d26f",xAxis:0},{name:"Asks",data:a,color:"#ff6565",fillColor:"#ff6565",xAxis:1}]})}):t(s,500,!1)};t(s,1e3,!1),t(d,1e3,!1)}]),diamondApp.controller("RegisterController",["$scope","$mdDialog",function(n,o){function t(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)}}t.$inject=["$scope","$mdDialog"],n.status="  ",n.customFullscreen=!1,n.showAlert=function(e){o.show(o.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("This is an alert title").textContent("You can specify some description text in here.").ariaLabel("Alert Dialog Demo").ok("Got it!").targetEvent(e))},n.showConfirm=function(e){var t=o.confirm().title("Would you like to delete your debt?").textContent("All of the banks have agreed to forgive you your debts.").ariaLabel("Lucky day").targetEvent(e).ok("Please do it!").cancel("Sounds like a scam");o.show(t).then(function(){n.status="You decided to get rid of your debt."},function(){n.status="You decided to keep your debt."})},n.showPrompt=function(e){var t=o.prompt().title("What would you name your dog?").textContent("Bowser is a common name.").placeholder("Dog name").ariaLabel("Dog name").initialValue("Buddy").targetEvent(e).required(!0).ok("Okay!").cancel("I'm a cat person");o.show(t).then(function(e){n.status="You decided to name your dog "+e+"."},function(){n.status="You didn't name your dog."})},n.showAdvanced=function(e){o.show({controller:t,templateUrl:"dialog1.tmpl.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,fullscreen:n.customFullscreen}).then(function(e){n.status='You said the information was "'+e+'".'},function(){n.status="You cancelled the dialog."})},n.showTabDialog=function(e){o.show({controller:t,templateUrl:"tabDialog.tmpl.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0}).then(function(e){n.status='You said the information was "'+e+'".'},function(){n.status="You cancelled the dialog."})},n.showPrerenderedDialog=function(e){o.show({contentElement:"#myDialog",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0})}}]),diamondApp.service("TradeOrderAccountService",["$http","$q",function(t,e){return{getAccountHistoryTradeOrders:function(e){return null==e&&(e=0),t.post("/trade-order/account-history-orders?pageNumber="+e,null,null).then(function(e){return e.data})}}}]),diamondApp.controller("TradeOrderAccountController",["$scope","$rootScope","$http","AccountService","TradeOrderAccountService",function(e,t,n,o,r){var a=this;e.getPreviousAccountHistoryOrders=function(e){r.getAccountHistoryTradeOrders(e+1).then(function(e){a.accountHistoryTradeOrders=e})},r.getAccountHistoryTradeOrders().then(function(e){a.accountHistoryTradeOrders=e})}]),diamondApp.controller("LiveTradeOrderController",["$scope","$rootScope","$http","$interval","$timeout","DiamondService","AccountService","TradeOrderService",function(e,t,n,o,r,a,i,c){var l=this;l.firstTimeOut=!0,e.tab=1,e.cancelTradeOrder=function(e){n.post("/trade-order/cancel",e,null).then(function(e){console.log("tradeOrder canceled  "+e.data),c.addHistoryOrder(e.data)})},e.getPreviousLiveOrders=function(e){c.getLiveOrders(e+1).then(function(e){l.liveTradeOrders=e})},c.getLiveOrders().then(function(e){l.liveTradeOrders=e});console.log("START LIVE"),window.setInterval(function(){!function(){if(null!=l.liveTradeOrders&&null!=l.liveTradeOrders.content){var e=new Array;for(var t in l.liveTradeOrders.content)null!=l.liveTradeOrders.content[t].id&&e.push(l.liveTradeOrders.content[t].id);n.post("/trade-order/live-orders-reread",e).then(function(e){l.liveTradeOrders.content=e.data})}}()},1e3)}]),diamondApp.service("TradeOrderService",["$http","$q",function(n,e){var o=null,t=[];return{getHistoryOrders:function(e){return n.post("/trade-order/history-orders",e.id,null).then(function(e){return t=e.data})},getLiveOrders:function(e){var t;return t=null==e?"/trade-order/live-orders":"/trade-order/live-orders?pageNumber="+e,n.post(t,null,null).then(function(e){return o=e.data,console.log("LO: "+o.content),o})},addLiveOrder:function(e){""==o.content&&(o.content=new Array),o.content.push(e)},addHistoryOrder:function(e){o.content.splice(arrayObjectIndexOf(o,e),1),t.push(e)}}}]),diamondApp.controller("MenuController",["$scope","$location","AccountService",function(e,t,n){e.isActive=function(e){return e===t.path()};var o=this;n.currentAccountCall().then(function(e){"empty"==e.account?o.account=null:o.account=e})}]),diamondApp.service("AlertService",["$http","$q","$mdDialog",function(e,t,n){return{showAlert:function(e,t){null==t&&(t="Some error occurred during execution."),n.show(n.alert().parent(angular.element(document.querySelector("body"))).clickOutsideToClose(!0).title(t).textContent(e).ariaLabel("Alert").ok("Got it!"))}}}]),diamondApp.controller("DiamondController",["$scope","$rootScope","$http","DiamondService",function(e,t,n,o){var r=this;o.getAllEnlistedDiamonds().then(function(e){r.diamonds=e})}]),diamondApp.config(["$mdIconProvider",function(e){e.iconSet("social","img/icons/sets/social-icons.svg",24).defaultIconSet("img/icons/sets/core-icons.svg",24)}]).directive("valueMatches",["$parse",function(i){return{require:"ngModel",link:function(t,e,n,o){var r=i(n.valueMatches),a=i(n.ngModel);t.$watch(n.ngModel,function(e){o.$setValidity(n.name,e===r(t))}),t.$watch(n.valueMatches,function(e){o.$setValidity(n.name,e===a(t))})}}}]).controller("RegistrationController",["$scope","$http","AlertService",function(e,t,n){e.account={email:"",password:null},e.createAccount=function(e){console.log(e),e.pwd=e.password.confirm,t.post("/accounts/register",e,null).then(function(e){e.data.error?n.showAlert(e.data.message):window.location.replace("/trade")},function(e){e.data.error?n.showAlert(e.data.message):n.showAlert(e)})}}]),diamondApp.service("BalanceActivityService",["$http","$q",function(e,t){var n=[];return{getBalanceActivities:function(){return null!=n&&0<n.length?t.resolve(n):e.post("/balance-activity/by-account",null).then(function(e){return n=e.data})}}}]),diamondApp.controller("BalanceActivityController",["$scope","$http","$rootScope","BalanceActivityService",function(e,t,n,o){var r=this;e.tab=1,e.getPreviousBalanceActivities=function(e){t.post("/balance-activity/by-account?pageNumber="+(e+1),null).then(function(e){r.balanceActivities=e.data})},t.post("/balance-activity/by-account?pageNumber=0",null).then(function(e){r.balanceActivities=e.data})}]),diamondApp.controller("CoinPaymentController",["$scope","$http","AccountService","AlertService",function(e,t,n,o){var r=this;window.setInterval(function(){t.post("/coin-payment/get-by-account",null).then(function(e){r.coinPayments=e.data})},1e3),r.depositRequest={amount:200},r.withdrawRequest={currencyCoin:"ETH",address:"",amount:10},e.createWithdraw=function(e){t({url:"/coin-payment/create-withdraw",method:"POST",params:e}).then(function(e){n.currentAccountCall(),e.data.error&&o.showAlert(e.data.message)},function(e){e.data.error?o.showAlert(e.data.message):o.showAlert(e)})}}]),diamondApp.controller("CoinController",["$scope","$http",function(e,t){var n=this;t.post("/diamond/by-id?diamondId=9",null,null).then(function(e){return n.coin=e.data,e.data})}]);